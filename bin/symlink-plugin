#!/usr/bin/env php
<?php

use WebTheory\WpCliUtil\WpCliUtil;

$root = dirname(__DIR__, 1);

require_once $root . '/vendor/autoload.php';

$composer = json_decode(file_get_contents($root . '/composer.json'), true);

$paths = [
  'wordpress-mixin' => '',
  'wordpress-muplugin' => 'mu-plugins',
  'wordpress-plugin' => 'plugins',
  'wordpress-theme' => 'themes',
];

$wordpress = WpCliUtil::getInstallPath() ?? 'wordpress';
$destination = "wp-content/" . $paths[$composer['type'] ?? 'wordpress-plugin'];

$link = preg_replace(
  '/\/+/',
  DIRECTORY_SEPARATOR,
  "$root/$wordpress/$destination/" . basename($root)
);

shell_exec("rm -f $link");
symlink($root, $link); // running this on windows requires administrator permissions
