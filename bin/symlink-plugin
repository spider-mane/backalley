#!/usr/bin/env php
<?php

use WebTheory\WpCliUtil\WpCliUtil;

if ($argc < 2) {
  echo "Must provide name to give symlink.\n";
  exit(1);
}

$root = dirname(__DIR__, 1);

require_once $root . '/vendor/autoload.php';

$composer = json_decode(file_get_contents($root . '/composer.json'), true);

$paths = [
  'wordpress-mixin' => '',
  'wordpress-muplugin' => 'mu-plugins',
  'wordpress-plugin' => 'plugins',
  'wordpress-theme' => 'themes',
];

$wordpress = WpCliUtil::getInstallPath() ?? 'wordpress';
$destination = $paths[$composer['type'] ?? 'wordpress-plugin'];

if (!file_exists($destination = "$root/$wordpress/wp-content/$destination")) {
  mkdir($destination, 0777, true);
}

$plugin = $argv[1];
$link = preg_replace('/\/+/', DIRECTORY_SEPARATOR, "$destination/$plugin");

shell_exec("rm -f $link");
symlink($root, $link); // running this on windows requires administrator permissions
